<!doctype html>
<html>

    <head>

        <meta charset="utf-8">
        <title>El grupo de los 10</title>
        <link rel="stylesheet" type="text/css" href="index.css">
        <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
        <script src="pixi.js"></script>

    </head>
    <body>

        <canvas id="mycanvas"></canvas>
        <script type="text/javascript">

            /* Funciones/propiedades interesantes

                let container = new PIXI.Container();
                sprite.tint = 0xffffff;
                sprite.scale = new PIXI.Point(0.5, 0.5)
                sprite.pivot.set(0, 100)
                sprite.alpha = 0.5; (Transaparencia)
                sprite.blendMode = PIXI.BLEND_MODES.MULTIPLY (Buscar "Pixijs blend modes")
                sprite.visible = false

                sprite.interactive = true
                sprite.buttonMode = true

                sprite.mask = sprite1 (Profundidad)
                https://www.youtube.com/watch?v=mCbyr8mGNRE (Graficos)

                    button
                    // Mouse & touch events are normalized into
                    // the pointer* events for handling different
                    // button events.
                        .on('pointerdown', onButtonDown)
                        .on('pointerup', onButtonUp)
                        .on('pointerupoutside', onButtonUp)
                        .on('pointerover', onButtonOver)
                        .on('pointerout', onButtonOut);

            */


            var player1, player1Atk, player1Dmg, player2, player2Atk, player2Dmg;
            var miMovimento;
            const frames1 = [];
            const framesAtk1 = [];
            const framesDmg1 = [];
            const frames2 = [];
            const framesAtk2 = [];
            const framesDmg2 = [];
            var golpe = false;
            let _w = window.innerWidth;
            let _h = window.innerHeight;
            var jugador1 = {

                Vida: 95,
				Ataque: 10,
				Defensa: 8,
				Velocidad: 12.5

            }
            var jugador2 = {

                Vida: 100,
                Ataque: 10,
                Defensa: 11,
                Velocidad: 9

            }
            const canvas = document.getElementById('mycanvas');

            const app = new PIXI.Application({

                view: canvas,
                width: _w,
                height: _h,
                resolution: window.devicePixelRatio,
                autoDensity: true

            });
            document.body.appendChild(app.view);

            const ticker = new PIXI.Ticker();
            app.loader
                .add('corti', 'assets/corti1/spritesheet.json')
                .add('cortiAtk', 'assets/cortiAtk1/spritesheet.json')
                .add('cortiDmg', 'assets/cortiDmg1/spritesheet.json')
                .add('diNardo', 'assets/diNardo2/spritesheet.json')
                .add('diNardoAtk', 'assets/diNardoAtk2/spritesheet.json')
                .add('diNardoDmg', 'assets/diNardoDmg2/spritesheet.json')
                .load(onplayer1Load);


            function onplayer1Load() {

                for (let i = 0; i < 6; i++)
                   frames1.push(PIXI.Texture.from(`corti1-${i}.png`)); 

                player1 = new PIXI.AnimatedSprite(frames1);
                player1.anchor.set(0.5);
                player1.animationSpeed = 0.1;
                player1.play();

                app.stage.addChild(player1);

                player1.interactive = true

                for (let i = 0; i < 10; i++)
                    framesAtk1.push(PIXI.Texture.from(`cortiAtk1-${i}.png`));
                for (let i = 0; i < 12; i++)
                    framesDmg1.push(PIXI.Texture.from(`cortiDmg1-${i}.png`));

                for (let i = 0; i < 6; i++)
                   frames2.push(PIXI.Texture.from(`diNardo2-${i}.png`)); 

                player2 = new PIXI.AnimatedSprite(frames2);
                player2.anchor.set(0.5);
                player2.animationSpeed = 0.1;
                player2.play();

                app.stage.addChild(player2);

                player2.interactive = true

                for (let i = 0; i < 17; i++)
                    framesAtk2.push(PIXI.Texture.from(`diNardoAtk2-${i}.png`));
                for (let i = 0; i < 10; i++)
                    framesDmg2.push(PIXI.Texture.from(`diNardoDmg2-${i}.png`));
                    
                player1.on('pointerdown', () => {

                    player1.stop()
                    player1.textures = framesAtk1;
                    player1.play();
                    setTimeout(function(){ 

                        player1.textures = frames1;
                        player1.play();

                    }, 2000);

                });

                app.ticker.add(animateSprite);

            }

            let delta = 0;
            function animateSprite() {

                delta += 0.1;
                player1.x = app.screen.width / 4.3;
                player1.y = app.screen.height / 3;
                player1.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                player2.x = app.screen.width / 1.3;
                player2.y = app.screen.height / 3;
                player2.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)

            }

            let fondo1 = new PIXI.Graphics();
            app.stage.addChild(fondo1);

            let fondo2 = new PIXI.Graphics();
            app.stage.addChild(fondo2);

            let vida1 = new PIXI.Graphics();
            app.stage.addChild(vida1);

            let vida2 = new PIXI.Graphics();
            app.stage.addChild(vida2);

            let Habilidad1 = new PIXI.Graphics();
            app.stage.addChild(Habilidad1);

            Habilidad1.interactive = true
            Habilidad1.buttonMode = true

            Habilidad1
                .on('pointerover', habilidad1Over)
                .on('pointerout', habilidad1Out)

            let Habilidad2 = new PIXI.Graphics();
            app.stage.addChild(Habilidad2);

            Habilidad2.interactive = true
            Habilidad2.buttonMode = true

            Habilidad2
                .on('pointerover', habilidad2Over)
                .on('pointerout', habilidad2Out)
                .on('pointerdown', combate);

            let Habilidad3 = new PIXI.Graphics();
            app.stage.addChild(Habilidad3);

            Habilidad3.interactive = true
            Habilidad3.buttonMode = true

            Habilidad3
                .on('pointerover', habilidad3Over)
                .on('pointerout', habilidad3Out)
                .on('pointerdown', combate);


            let Habilidad4 = new PIXI.Graphics();
            app.stage.addChild(Habilidad4);

            Habilidad4.interactive = true
            Habilidad4.buttonMode = true

            Habilidad4
                .on('pointerover', habilidad4Over)
                .on('pointerout', habilidad4Out)
                .on('pointerdown', combate);

            app.ticker.add(animateAll);

            function habilidad1Over(){

                Habilidad1.beginFill(0xc3c3c3)
                Habilidad1.drawRect(-100, -50, 200, 100);
                Habilidad1.endFill();
                miMovimento = 1;

            }

            function habilidad1Out(){

                Habilidad1.beginFill(0xdfdfdf)
                Habilidad1.drawRect(-100, -50, 200, 100);
                Habilidad1.endFill();
                
            }

            function habilidad2Over(){

                Habilidad2.beginFill(0xc3c3c3)
                Habilidad2.drawRect(-100, -50, 200, 100);
                Habilidad2.endFill();
                miMovimento = 2;

            }

            function habilidad2Out(){

                Habilidad2.beginFill(0xdfdfdf)
                Habilidad2.drawRect(-100, -50, 200, 100);
                Habilidad2.endFill();

            }

            function habilidad3Over(){

                Habilidad3.beginFill(0xc3c3c3)
                Habilidad3.drawRect(-100, -50, 200, 100);
                Habilidad3.endFill();
                miMovimento = 3;

            }

            function habilidad3Out(){

                Habilidad3.beginFill(0xdfdfdf)
                Habilidad3.drawRect(-100, -50, 200, 100);
                Habilidad3.endFill();

            }
                
            function habilidad4Over(){

                Habilidad4.beginFill(0xc3c3c3)
                Habilidad4.drawRect(-100, -50, 200, 100);
                Habilidad4.endFill();
                miMovimento = 4;

            }

            function habilidad4Out(){

                Habilidad4.beginFill(0xdfdfdf)
                Habilidad4.drawRect(-100, -50, 200, 100);
                Habilidad4.endFill();

            }

            function animateAll() {

                var high = 30 - (app.screen.height / 17);
                if(high > -30) high = -30;
                console.log(high);
                console.log(30 - (app.screen.width / 17));
                vida1.x = app.renderer.width / 6.1;
                vida1.y = app.renderer.height / 9;
                vida1.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                vida1.clear();
                vida1.lineStyle(3, 0xebf9e4);
                vida1.beginFill(0x52ff52)
                vida1.drawRect(-73, -30, 400 - (app.screen.width / 12.6), high);
                vida1.endFill();
                fondo1.x = app.renderer.width / 6.1;
                fondo1.y = app.renderer.height / 9;
                fondo1.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                fondo1.clear()
                fondo1.beginFill(0xebf9e4)
                fondo1.drawRect(-73, -30, 400 - (app.screen.width / 12.6), high);
                fondo1.endFill();
                vida2.x = app.renderer.width / 1.5;
                vida2.y = app.renderer.height / 9;
                vida2.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                vida2.clear();
                vida2.lineStyle(3, 0xebf9e4);
                vida2.beginFill(0x52ff52)
                vida2.drawRect(-73, -30, 400 - (app.screen.width / 12.6), high);
                vida2.endFill();
                fondo2.x = app.renderer.width / 1.5;
                fondo2.y = app.renderer.height / 9;
                fondo2.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                fondo2.clear()
                fondo2.beginFill(0xebf9e4)
                fondo2.drawRect(-73, -30, 400 - (app.screen.width / 12.6), high);
                fondo2.endFill();
                Habilidad1.x = app.renderer.width / 4.3;
                Habilidad1.y = app.renderer.height / 1.5;
                Habilidad1.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                Habilidad1.clear()
                Habilidad1.lineStyle(3, 0xebf9e4);
                Habilidad1.beginFill(0xdfdfdf)
                Habilidad1.drawRect(-120, -50, 200 - (app.screen.width / 50), 70 - high);
                Habilidad1.endFill();
                Habilidad2.x = app.renderer.width / 2.43;
                Habilidad2.y = app.renderer.height / 1.5;
                Habilidad2.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                Habilidad2.clear()
                Habilidad2.lineStyle(3, 0xebf9e4);
                Habilidad2.beginFill(0xdfdfdf)
                Habilidad2.drawRect(-110, -50, 200 - (app.screen.width / 50), 70 - high);
                Habilidad2.endFill();
                Habilidad3.x = app.renderer.width / 1.7;
                Habilidad3.y = app.renderer.height / 1.5;
                Habilidad3.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                Habilidad3.clear()
                Habilidad3.lineStyle(3, 0xebf9e4);
                Habilidad3.beginFill(0xdfdfdf)
                Habilidad3.drawRect(-100, -50, 200 - (app.screen.width / 50), 70 - high);
                Habilidad3.endFill();
                Habilidad4.x = app.renderer.width / 1.3;
                Habilidad4.y = app.renderer.height / 1.5;
                Habilidad4.scale = new PIXI.Point(app.screen.width / 1000, app.screen.height / 1000)
                Habilidad4.clear()
                Habilidad4.lineStyle(3, 0xebf9e4);
                Habilidad4.beginFill(0xdfdfdf)
                Habilidad4.drawRect(-90, -50, 200 - (app.screen.width / 50), 70 - high);
                Habilidad4.endFill();

            }
            /*player1.on('pointerdown', () => {

                player1.stop()
                player1.textures = framesAtk1;
                player1.play();
                setTimeout(function(){ 

                    player1.textures = frames1;
                    player1.play();
                    player2.textures = framesDmg2;
                    player2.play();
                    setTimeout(function(){ 

                        player2.textures = frames2;
                        player2.play();
                        setTimeout(function(){ 

                            player2.textures = framesAtk2;
                            player2.play();
                            setTimeout(function(){ 

                                player2.textures = frames2;
                                player2.play();
                                player1.textures = framesDmg1;
                                player1.play();
                                setTimeout(function(){ 

                                    player1.textures = frames1;
                                    player1.play();

                                }, 2000);

                            }, 4000);

                        }, 2000);

                    }, 2000);

                }, 2000);

            });*/

            function combate(){

                switch(miMovimento){

                    case 1:

                        jugador1.Defensa += 1.5;
                        jugador1.Velocidad -= 1;
                        break;
                    
                    case 2:

                        jugador2.Vida -= (20 * jugador1.Ataque) / jugador2.Defensa
                        if(jugador2.Vida < 0) jugador2.Vida = 0
                        golpe = True
                        break;

                    case 3:

                        jugador2.Vida -= (30 * jugador1.Ataque) / jugador2.Defensa
                        if(jugador2.Vida < 0) jugador2.Vida = 0
                        golpe = True
                        break;

                    case 4:

                        break;

                }
                var suMovimiento = Math.floor((Math.random() * 4) + 1);
                switch(suMovimiento){

                case 1:

                    jugador2.Defensa += 1;
                    break;

                case 2:

                    break;

                case 3:

                    jugador1.Vida -= (20 * jugador2.Ataque) / jugador1.Defensa;
                    if(jugador1.Vida < 0) jugador1.Vida = 0;
                    golpe = True;
                    break;

                case 4:

                    jugador2.Vida -= 30;
                    if(jugador2.Vida < 0) jugador2.Vida = 0;
                    jugador2.Defensa += 1.5;
                    jugador2.Ataque += 0.5;
                    golpe = True
                    break;

                }

            }

            window.addEventListener('resize', resize);
            function resize(){

                _w = window.innerWidth;
                _h = window.innerHeight;
                app.renderer.resize(_w, _h);
                
            }

            
            /*const texture = PIXI.Texture.from('sprite.png');
            const texture1 = PIXI.Texture;
            img = new PIXI.Sprite(texture);
            img.x = app.renderer.width / 2;
            img.y = app.renderer.height / 2;
            img.anchor.x = 0.5;
            img.anchor.y = 0.5;
            img.alpha = 0.5;
            app.stage.addChild(img);

            img.interactive = true
            img.buttonMode = true

            img.on('pointertap', () => {

                img.texture = texture1;
                setTimeout(function(){ 

                    img.texture = texture;

                }, 2000);

            });

            */
        

        </script>

    </body>
    
</html>